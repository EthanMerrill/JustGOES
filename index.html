<!DOCTYPE html>
<html>
<!-- local stylesheet -->
<link rel="stylesheet" href="style.css">

<head>
    <!-- Refresh the page every 10 minutes -->
    <meta http-equiv="refresh" content="600">
</head>

<body>
    <div class=page-container>
        <div class="img-container">
            <img id="satImage" src="">
            <div class="noaa-cover cover"></div>
            <div class='date-cover cover'></div>
        </div>
    </div>

</body>

</html>
<script>
    // get screem size 

    // https://forum.freecodecamp.org/t/freecodecamp-challenge-guide-where-do-i-belong/16094
    function getIndexToIns(arr, num) {
        arr.sort(function(a, b) {
            return a - b;
        });

        var i = 0;
        while (num > arr[i]) {
            i++;
        }

        return i;
    }


    // Create date object
    function getDate(offset) {
        //utility function to pad minutes and hours: 
        function pad(value) {
            if (value < 10) {
                return '0' + value;
            } else {
                return value;
            }
        }
        var now = new Date();

        var utc_timestamp = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),
            now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds(), now.getUTCMilliseconds());

        oldminutes = now.getUTCMinutes()

        now.setUTCMinutes(Math.floor((oldminutes - offset) / 10) * 10)

        var start = new Date(now.getFullYear(), 0, 0);
        var diff = now - start;
        var oneDay = 1000 * 60 * 60 * 24;
        var day = Math.floor(diff / oneDay);

        if (now.getUTCMinutes() == 0) {
            goesTimeMinutes = "00"
        } else {
            goesTimeMinutes = now.getUTCMinutes().toString()
        }
        return (now.getUTCFullYear().toString() + day.toString() + pad(now.getUTCHours()).toString() + goesTimeMinutes)

    }

    async function updateImage(goesTime, imageSize) {
        goesSrcString = `https://cdn.star.nesdis.noaa.gov/GOES16/ABI/FD/GEOCOLOR/${goesTimeObject}_GOES16-ABI-FD-GEOCOLOR-${imageSize}x${imageSize}.jpg`
        satImage = document.getElementById("satImage").src = goesSrcString
        return Promise
    }


    let offset = 40
    goesTimeObject = getDate(offset)
        // Find the smallest image size to get given the display resolution
    imageSizes = [339, 678, 1808, 5424, 10848]
    imageSize = (imageSizes[getIndexToIns(imageSizes, window.innerHeight)])
    lookbackImage(offset);

    async function lookbackImage(offset) {
        var i = 0
        while (i < 500) {
            offset = offset + 10
            goesTimeObject = getDate(offset)
            updateImage(goesTimeObject, imageSize)
            let imgHeight = await document.getElementById('satImage').height
            if (imgHeight > Math.min(...imageSizes)) {
                console.log(`${imgHeight} image found for ${goesTimeObject}`)
                break
            }
            console.log(`${imgHeight} image NOT found for ${goesTimeObject}`)
            i++
        }
    }
</script>